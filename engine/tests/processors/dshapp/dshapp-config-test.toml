[processor]
processor-technology = "dshapp"
processor-realization-id = "test"
label = "Test DSH Service"
description = "Test profiles"
version = "0.1.2"
icon = "ICON"
more-info-url = "https://dsh.kpn.com"
metrics-url = "https://grafana.com"
viewer-url = "https://eavesdropper.kpn.com"

metadata = [
    ["metadata1", "METADATA1"],
    ["metadata2", "METADATA2"]
]

[inbound-junctions.inbound-topic]
junction-technology = "kafka"
label = "Test inbound topic"
description = "Test inbound topic description"

[outbound-junctions.outbound-topic]
junction-technology = "kafka"
label = "Test outbound topic"
description = "Test outbound topic description"
minimum-number-of-connections = 1
maximum-number-of-connections = 2

[deploy]
parameters = [
    { type = "boolean", id = "bool1", label = "B1", description = "DB1" },
    { type = "boolean", id = "bool2", label = "B2", description = "DB2", optional = true, default = "true" },
    { type = "boolean", id = "bool3", label = "B3", description = "DB3", initial-value = "true" },
    { type = "free-text", id = "free1", label = "F1", description = "DF1" },
    { type = "free-text", id = "free2", label = "F2", description = "DF2", initial-value = "I2" },
    { type = "free-text", id = "free3", label = "F3", description = "DF3", optional = true, default = "D3" },
    { type = "free-text", id = "free4", label = "F4", description = "DF4", initial-value = "I4", optional = true, default = "D4" },
    { type = "selection", id = "sel1", label = "S1", description = "DS1", options = ["s11"] },
    { type = "selection", id = "sel2", label = "S2", description = "DS2", options = [{ id = "sx1", label = "SX1" }, { id = "sx2", label = "SX2", description = "D2" }], optional = true, default = "sx2" },
    { type = "selection", id = "sel3", label = "S3", description = "DS3", options = [{ id = "sx1", label = "SX1" }, "s11"], initial-value = "s11" },
    { type = "selection", id = "sel4", label = "S4", description = "DS4", options = ["s11"], initial-value = "s11", optional = true, default = "s11" }
]

[health-check]
ping = { host = "127.0.0.1", timeout-millis = 3000 }
http-response-status = { endpoint = "www.kpn.com", accepted-response-status = [200, 202, 204], timeout-millis = 3000 }

[dshservice]

image = "test-image:0.1.2-SNAPSHOT"
needs-token = true
single-instance = false
spread-group = "SPREAD_GROUP"

[dshservice.exposed-ports.3000]
vhost = "{ vhost('your-vhost-name','a-zone') }"
auth = "app-realm:admin:$1$EZsDrd93$7g2osLFOay4.TzDgGo9bF/"
mode = "http"
whitelist = "0.0.0.0 127.0.0.1"
paths = ["/abc"]
service-group = "mygroup"

[dshservice.health-check]
protocol = "http"
port = 8080
path = "/healthpath"

[dshservice.metrics]
port = 9095
path = "/metrics"

[[dshservice.secrets]]
name = "secret_name"
injections = [{ env = "SECRET" }]

[dshservice.volumes]
"/volume_path" = "{ volume('correct_volume_name') }"

[dshservice.environment-variables]

DSHSERVICE_ENV_VAR1 = { type = "deployment-parameter", id = "bool1" }
DSHSERVICE_ENV_VAR2 = { type = "inbound-junction", id = "inbound-topic" }
DSHSERVICE_ENV_VAR3 = { type = "outbound-junction", id = "outbound-topic" }
DSHSERVICE_ENV_VAR4 = { type = "template", value = "value4${TENANT}" }
DSHSERVICE_ENV_VAR5 = { type = "value", value = "value5" }

[[dshservice.profiles]]
profile-id = "profile-1"
label = "Profile 1"
description = "Profile 1"
cpus = 1
instances = 1
mem = 1
[dshservice.profiles.environment-variables]
PROFILE1_ENV_VAR1 = { type = "deployment-parameter", id = "free1" }
PROFILE1_ENV_VAR2 = { type = "inbound-junction", id = "inbound-topic" }
PROFILE1_ENV_VAR3 = { type = "outbound-junction", id = "outbound-topic" }
PROFILE1_ENV_VAR4 = { type = "template", value = "value14${TENANT}" }
PROFILE1_ENV_VAR5 = { type = "value", value = "value15" }

[[dshservice.profiles]]
profile-id = "profile-1"
label = "Profile 1"
description = "Profile 2"
cpus = 2
instances = 2
mem = 2
[dshservice.profiles.profile-2.environment-variables]
PROFILE2_ENV_VAR1 = { type = "deployment-parameter", id = "sel1" }
PROFILE2_ENV_VAR2 = { type = "inbound-junction", id = "inbound-topic" }
PROFILE2_ENV_VAR3 = { type = "outbound-junction", id = "outbound-topic" }
PROFILE2_ENV_VAR4 = { type = "template", value = "value24${TENANT}" }
PROFILE2_ENV_VAR5 = { type = "value", value = "value25" }
